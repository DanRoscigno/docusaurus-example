<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.fd17476c3">
<link rel="alternate" type="application/rss+xml" href="/personal-website/blog/rss.xml" title="Kristijan Bakaric Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/personal-website/blog/atom.xml" title="Kristijan Bakaric Blog Atom Feed"><title data-react-helmet="true">Data Engineering Project - Azure APIM, Azure Functions, Blob Storage - Part 3 | Kristijan Bakaric</title><meta data-react-helmet="true" property="og:title" content="Data Engineering Project - Azure APIM, Azure Functions, Blob Storage - Part 3 | Kristijan Bakaric"><meta data-react-helmet="true" name="description" content="In this post, I will explain how I created the first part of the data streaming pipeline which has an API gateway that will accept API calls (with tweet messages) and route them to the Azure Function, that further processes the data and (initially) store them to Azure Blob Storage."><meta data-react-helmet="true" property="og:description" content="In this post, I will explain how I created the first part of the data streaming pipeline which has an API gateway that will accept API calls (with tweet messages) and route them to the Azure Function, that further processes the data and (initially) store them to Azure Blob Storage."><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://baky0905.github.io/personal-website/blog/2021/03/07/data-engineering-part3"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/personal-website/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://baky0905.github.io/personal-website/blog/2021/03/07/data-engineering-part3"><link data-react-helmet="true" rel="alternate" href="https://baky0905.github.io/personal-website/blog/2021/03/07/data-engineering-part3" hreflang="x-default"><link rel="stylesheet" href="/personal-website/assets/css/styles.d23e3c1a.css">
<link rel="preload" href="/personal-website/assets/js/styles.f0712210.js" as="script">
<link rel="preload" href="/personal-website/assets/js/runtime~main.e092c695.js" as="script">
<link rel="preload" href="/personal-website/assets/js/main.79c46ea4.js" as="script">
<link rel="preload" href="/personal-website/assets/js/1.7cb82093.js" as="script">
<link rel="preload" href="/personal-website/assets/js/2.fca674a5.js" as="script">
<link rel="preload" href="/personal-website/assets/js/3.bad86c3d.js" as="script">
<link rel="preload" href="/personal-website/assets/js/ccc49370.180471ef.js" as="script">
<link rel="preload" href="/personal-website/assets/js/7c459c90.378e2022.js" as="script">
<link rel="preload" href="/personal-website/assets/js/5f88ae9a.1adc255b.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_1oUP">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/personal-website/"><img src="/personal-website/img/logo.png" alt="Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/personal-website/img/logo.png" alt="Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">KB</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/personal-website/blog">Blog</a><a class="navbar__item navbar__link" href="/personal-website/blog/tags/projects">Projects</a><a class="navbar__item navbar__link" href="/personal-website/docs/bookmarks">THE Bookmarks</a><a class="navbar__item navbar__link" href="/personal-website/docs/bookmarks-norway">Awesome Norway</a></div><div class="navbar__items navbar__items--right"><a href="https://www.linkedin.com/in/kristijanb/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">LinkedIn</a><a href="https://github.com/baky0905" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a class="navbar__item navbar__link" href="/personal-website/docs/about/about-me">About Me</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/personal-website/"><img src="/personal-website/img/logo.png" alt="Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/personal-website/img/logo.png" alt="Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">KB</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/personal-website/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/personal-website/blog/tags/projects">Projects</a></li><li class="menu__list-item"><a class="menu__link" href="/personal-website/docs/bookmarks">THE Bookmarks</a></li><li class="menu__list-item"><a class="menu__link" href="/personal-website/docs/bookmarks-norway">Awesome Norway</a></li><li class="menu__list-item"><a href="https://www.linkedin.com/in/kristijanb/" target="_blank" rel="noopener noreferrer" class="menu__link">LinkedIn</a></li><li class="menu__list-item"><a href="https://github.com/baky0905" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a class="menu__link" href="/personal-website/docs/about/about-me">About Me</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/personal-website/blog/2021/04/02/docusaurus">From Markdown to a Docusaurus Website via GitHub, gh Actions, and gh pages</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/personal-website/blog/2021/03/08/data-engineering-part4">Data Engineering Project - Azure Event Hubs, Function and Cosmos DB - Part 4</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/personal-website/blog/2021/03/07/data-engineering-part3">Data Engineering Project - Azure APIM, Azure Functions, Blob Storage - Part 3</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/personal-website/blog/2021/03/06/data-engineering-part2">Data Engineering Project - Pre-process data - Part 2</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/personal-website/blog/2021/02/28/data-engineering-part1">Data Engineering Project - Intro - Part 1</a></li></ul></div></div><main class="col col--8"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">Data Engineering Project - Azure APIM, Azure Functions, Blob Storage - Part 3</h1><div class="margin-vert--md"><time datetime="2021-03-07T00:00:00.000Z" class="blogPostDate_fNvV">March 7, 2021  Â· 7 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://www.linkedin.com/in/kristijanb/" target="_blank" rel="noreferrer noopener"><img src="https://media-exp1.licdn.com/dms/image/C4E03AQF-5oI5fHJPjw/profile-displayphoto-shrink_800_800/0/1606336983715?e=1620259200&amp;v=beta&amp;t=VvBP6s8IMDUwKDfvj6B3c-gGmN3IfioALIAboXg_DGE" alt="Kristijan Bakaric"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://www.linkedin.com/in/kristijanb/" target="_blank" rel="noreferrer noopener">Kristijan Bakaric</a></h4><small class="avatar__subtitle">Mr.</small></div></div></header><div class="markdown"><p><img src="https://images.unsplash.com/photo-1518289646039-3e6c87a5aaf6?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=2102&amp;q=80"></p><blockquote><p>In this post, I will explain how I created the first part of the data streaming pipeline which has an API gateway that will accept API calls (with tweet messages) and route them to the Azure Function, that further processes the data and (initially) store them to Azure Blob Storage.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>Now that we have the data in the desired format and with the relevant content, we can embark in the world of Azure where we will select a suite of services that will assist us in reaching our goal, and that is to build a data streaming pipeline.</p><p>In this blog post I touch upon following Azure services (see also the diagram below):</p><ul><li><p><a href="https://docs.microsoft.com/en-us/azure/api-management/api-management-key-concepts" target="_blank" rel="noopener noreferrer">Azure API Management</a></p></li><li><p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview" target="_blank" rel="noopener noreferrer">Azure Functions</a></p></li><li><p><a href="https://docs.microsoft.com/en-us/azure/key-vault/general/overview" target="_blank" rel="noopener noreferrer">Azure Key Vault</a> </p></li><li><p><a href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction" target="_blank" rel="noopener noreferrer">Azure Blob Storage</a> </p></li></ul><p><img src="/personal-website/assets/images/diagramme-a3129a89146da039e92f876863db303a.png">
Figure 1: Diagramme of the data preparation process.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-1---azure-api-management"></a>Step 1 - Azure API Management<a class="hash-link" href="#step-1---azure-api-management" title="Direct link to heading">#</a></h1><p>As explained in the official Microsoft&#x27;s docs, API Management (APIM) is a way to create consistent and modern API gateways for existing back-end services.</p><p>My API gateway in APIM:</p><ul><li>had a single API endpoint that would accept API calls (requests with tweet messages)</li><li>API references to the back-end Function App which I previously already  had to create, for it to be accessible when I add an API in APIM</li><li>single POST operation mapped to the operation implemented in the backend Function App service that was written in Python.</li></ul><p>Settings in the API were configured as follows:</p><p><img src="/personal-website/assets/images/api-settings1-39375c21f8b253f07dea81190a4a3e73.png"></p><p><img src="/personal-website/assets/images/api-settings2-14e2906dff84dec5245eed4db4abe4f7.png"></p><p>What is important to notice that <code>Subscription Required</code> is toggled on.
When you publish APIs through API Management, it&#x27;s easy and common to secure access to those APIs by using subscription keys, which I immediately did leave as it was by default - with subscription required.</p><p>To consume the published API, I now have to include a valid subscription key in the HTTP requests header when I make calls to the created API. Otherwise, the calls are rejected immediately by the API Management gateway. They aren&#x27;t forwarded to the back-end services.</p><p>In addition to the subscription key required, I wanted to check out and test Policies which are a powerful capability of the Azure API Management (APIM) that allows the publisher to change the behaviour of the API through configuration. APIM policy is a collection of statements executed sequentially on the request or response of an API. We can define our policy statement in four configuration sections: inbound, backend, outbound, and on-error. It is nicely explained here by </p><p>As he wrote in the post, although we can think of Basic authentication as a legacy, there are still companies who are using this authentication mechanism, mostly because of its simplicity and legacy software base. </p><p>The following is the overview of the steps I did to enable a Basic Authentication policy together with all necessary steps:</p><p>1) Enabled managed identity for API management.
2) Created a Key Vault in Azure.
<img src="/personal-website/assets/images/key_vault-02ede9dacfe2112fbf2c23f600ca3f65.png">
3) Enabled access to the key vault secrets from API management.
4) Added demoUserName and demoUserPassword as keys, and values as actual username and passwords.
5) Create a Named value in the API Management with the Key Vault URL, password and username.
<img src="/personal-website/assets/images/key_vault2-a0aaa66ef19633079cf3651dabf87c5e.png">
6) In the inbound part of your Policy definition, added the following code:</p><div class="mdxCodeBlock_3lFL"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ```</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;policies&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;inbound&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;base /&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;choose&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &lt;when condition=&quot;@(context.Request.Headers.     GetValueOrDefault(&quot;Authorization&quot;).AsBasic().UserId!=&quot;{     {username}}&quot; || context.Request.Headers.GetValueOrDefault  (&quot;Authorization&quot;).AsBasic().Password!=&quot;{{password}}&quot;)&quot;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    &lt;return-response&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        &lt;set-status code=&quot;401&quot; reason=&quot;Not authorized&quot; /&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    &lt;/return-response&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &lt;/when&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;/choose&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;set-header name=&quot;Authorization&quot; exists-action=&quot;delete&quot; /&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;/inbound&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;backend&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;base /&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;/backend&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;outbound&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;base /&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;/outbound&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;on-error&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &lt;base /&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;/on-error&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;/policies&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ```  </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>7) Tested with a request containing the following header (it was within the Test API part of the APIM on Azure portal so Ocp-Apim-Subscription-Key: â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢â¢ was added automatically if toggled on in the settings): </p><div class="mdxCodeBlock_3lFL"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">`Authorization Basic &lt;Base64 representation of the combination username:password&gt;`</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>HTTP triggered Azure function was executed successfully with a 200 OK status.</li></ul><p>Now that I have a double secure way of consuming created API, let us rewind a bit, and go to a prerequisite and that is creating an Azure Function that will act as a backend and have bindings to Azure Blob Storage and Azure Events Hub.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-2---or-step-0-actually---azure-functions"></a>Step 2 - (or step 0 actually) - Azure Function(s)<a class="hash-link" href="#step-2---or-step-0-actually---azure-functions" title="Direct link to heading">#</a></h2><p>Azure Function App consists of two Azure Functions as a part of an Azure streaming data pipeline:</p><p>1) Azure Function in our case is acting as a backend in Azure API management and is consuming POST requests with tweet messages. In the function logic, it checks for validity and conformity of the JSON messages to a predefined JSON schema, and if valid, it passes the JSON onwards to Azure Event Hubs and writes them to Azure Blob Storage as JSON files.</p><div class="mdxCodeBlock_3lFL"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">`./HttpTriggerTweetToBlobAndEventHub`</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="/personal-website/assets/images/http-func-62612a741ffe79f21662cd25830fbf6a.png">   </p><p>I will not go into details of the development environment (Locally developed on WSL2 with Ubuntu 20.04 via Visual Studio Code and its plugins for Azure Services), and Python code itself since it is anyway very simple.</p><p>The function has two validation steps:</p><p>1) Python logic to check if valid JSON was sent via HTTP request, if invalid, it raises an exception with an appropriate message and status code to the sender client.</p><p>2) Check if the JSON message is conforming to the predefined JSON schema:</p><div class="mdxCodeBlock_3lFL"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">tweet_schema = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    # &quot;$schema&quot;: &quot;http://json-schema.org/draft-04/schema#&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;type&quot;: &quot;object&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;properties&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;tweet_id&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;integer&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;account_id&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;integer&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;likes&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;integer&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;replies&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;integer&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;retweets&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;integer&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;tweet&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;string&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;time&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;integer&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;tear_month_date&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;string&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;damage_flag&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;string&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;image_base64&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;string&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;latitude&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;number&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;longitude&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;type&quot;: &quot;number&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;required&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;tweet_id&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;account_id&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;likes&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;replies&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;retweets&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;tweet&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;time&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;tear_month_date&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;damage_flag&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;image_base64&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;latitude&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;longitude&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-3---write-messages-to-azure-blob-storage"></a>Step 3 - Write messages to Azure Blob Storage<a class="hash-link" href="#step-3---write-messages-to-azure-blob-storage" title="Direct link to heading">#</a></h2><p>If an incoming JSON  request was accepted by API in Azure APIM, and if Azure Function validated the body of the tweet message successfully I decided to initially test writing successful messages with the Azure Function bindings towards the Azure Blob Storage.</p><p>For the ones that are not familiar with the binding in Azure Functions, [binding](Binding to a function is a way of declaratively connecting another resource to the function; bindings may be connected as input bindings, output bindings, or both. Data from bindings is provided to the function as parameters.) to a function is a way of declaratively connecting another resource to the function; bindings may be connected as input bindings, output bindings, or both. Data from bindings are provided to the function as parameters.</p><p>This is how my binding is defined in the Azure Function bindings definition:</p><div class="mdxCodeBlock_3lFL"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">   {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;type&quot;: &quot;blob&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;direction&quot;: &quot;out&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot;: &quot;outputBlob&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;path&quot;: &quot;output/{rand-guid}.json&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;connection&quot;: &quot;AzureWebJobsStorage&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>It is obvious that after successfully sending an x number of HTTP requests with tweets to an API endpoint, and thus to Azure function backend, all messages were successfully written as JSON files with a rand-guid id as the filename.</p><p><img src="/personal-website/assets/images/blob_output-73db3fbf30f74d52966814d8ec0522c9.png">  </p><p>This is the content of one example tweet opened directly in blob storage:</p><p><img src="/personal-website/assets/images/json_example-e7c94cc60b974a0b1ad342d9efde298a.png"> </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="in-the-next-post"></a>In the Next Post...<a class="hash-link" href="#in-the-next-post" title="Direct link to heading">#</a></h2><p>We now have a secure functioning API endpoint that accepts valid and well-defined tweet messages sent as HTTP POST requests, and the body of requests are successfully being written to Azure blob storage as JSON files.</p><p>In the next post, I will introduce and create the following Azure Services:</p><ul><li><p><a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-about" target="_blank" rel="noopener noreferrer">Azure Event Hubs</a></p></li><li><p><a href="https://docs.microsoft.com/en-us/azure/cosmos-db/introduction" target="_blank" rel="noopener noreferrer">Azure Cosmos DB</a> - SQL Core - Document Store</p></li></ul><p>The main goal will be to have Azure Event Hubs as a big data streaming platform and event ingestion service which can receive and process millions of events per second (not our case but it has the possibility), and also store the messages into Azure Cosmos DB&#x27;s, a SQL Core - Document Store, which purpose is to act as a fully managed NoSQL database. </p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/personal-website/blog/tags/dataengineering">dataengineering</a><a class="margin-horiz--sm" href="/personal-website/blog/tags/projects">projects</a><a class="margin-horiz--sm" href="/personal-website/blog/tags/azure">azure</a><a class="margin-horiz--sm" href="/personal-website/blog/tags/python">python</a><a class="margin-horiz--sm" href="/personal-website/blog/tags/api">api</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/personal-website/blog/2021/03/08/data-engineering-part4"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Data Engineering Project - Azure Event Hubs, Function and Cosmos DB - Part 4</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/personal-website/blog/2021/03/06/data-engineering-part2"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Data Engineering Project - Pre-process data - Part 2 Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#step-2---or-step-0-actually---azure-functions" class="table-of-contents__link">Step 2 - (or step 0 actually) - Azure Function(s)</a></li><li><a href="#step-3---write-messages-to-azure-blob-storage" class="table-of-contents__link">Step 3 - Write messages to Azure Blob Storage</a></li><li><a href="#in-the-next-post" class="table-of-contents__link">In the Next Post...</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Kristijan Bakaric, Built with Docusaurus.</div></div></div></footer></div>
<script src="/personal-website/assets/js/styles.f0712210.js"></script>
<script src="/personal-website/assets/js/runtime~main.e092c695.js"></script>
<script src="/personal-website/assets/js/main.79c46ea4.js"></script>
<script src="/personal-website/assets/js/1.7cb82093.js"></script>
<script src="/personal-website/assets/js/2.fca674a5.js"></script>
<script src="/personal-website/assets/js/3.bad86c3d.js"></script>
<script src="/personal-website/assets/js/ccc49370.180471ef.js"></script>
<script src="/personal-website/assets/js/7c459c90.378e2022.js"></script>
<script src="/personal-website/assets/js/5f88ae9a.1adc255b.js"></script>
</body>
</html>